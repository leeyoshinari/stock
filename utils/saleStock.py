#!/usr/bin/env python
# -*- coding: utf-8 -*-
# Author: leeyoshinari

'''
你是一个精通中国A股市场的交易员，擅长根据股票走势判断是否买入卖出股票。请根据以下信息判断当前时间是否卖出股票，及时止盈止损，请使用python代码实现判断是否应该卖出？不要使用numpy和pandas等第三方包

提供的参数:
- cost: float, 持有成本
- rise_limit: float, 涨停幅度，例如0.1或0.2
- days_kline: list[dict], 每一天的天级K线数据和技术指标，最近5天的数据，最后一天是当天的实时数据
    每个dict的字段解释: current_price：当日收盘价；last_price：前一日收盘价；open_price：开盘价；max_price：最高价；min_price：最低价；volume：成交量；fund：主力资金净流入（单位：万）；turnover_rate：换手率；ma_five：5日均线；ma_ten：10日均线；ma_twenty：20日均线和布林线中轨线；qrr：量比；diff：MACD的DIFF；dea：MACD的DEA；k：KDJ的K值；d：KDJ的D值；j：KDJ的J值；trix：TRIX指标值；trma：TRIX均线；boll_up：布林线上轨线；boll_low：布林线下轨线
- days_minute_price: list[list[float]], 最近2天的分钟级价格列表，最后一天是当天的部分数据；如果你需要5min中的价格数据，你可以自己计算出来然后使用
- days_minute_volume: list[list[int]], 最近2天的分钟级成交量列表，与days_minute_price对应；如果你需要5min中的成交量数据，你可以自己计算出来然后使用

以下是一些补充说明和交易策略：
1、已知输入的数据是当天截至当前分钟的数据，price和volume都是一个数组，数组最后的数据是最新时间的数据，你只需要判断到当前时间是否应该卖出股票；也有可能不是当天截至当前分钟的所有数据，你需要自己判断并告诉我你需要多长时间的数据；
2、如果股票亏损，那么股票的止损点是10%，不到止损点就继续持有，等待股票上涨；
3、如果股票盈利，那么在股票涨势较好的情况下不需要止盈，继续持有获得更多的收益；如果股票已经盈利，短时间放量下跌回撤，那么当回撤3%时，需要及时止盈，如果回撤后股票处于亏损状态，则不需要止盈或止损，继续持有；
4、股票可以持有很多天，你需要给出一个比较好的方法解决前一天收盘和第二天开盘的数据衔接问题，特别是股票已经上涨后开盘大幅下跌的情况更应该卖出股票；
5、中国A股部分股票涨停是10%，部分股票涨停是20%，如果当天股票涨停，不需要做任何处理，继续持有股票；
6、股票可能开盘直接涨停封板，也可能上下波动慢慢上涨直到涨停，你需要能够处理这种情况，保持持有股票，不能轻易卖出股票；
7、如果股票前几天涨的很好，突然某一天开盘大幅下跌超过3%，你需要及时卖出股票，所以你不能只根据总收益判断，你还需要结合当天的实际行情数据和前一天的收盘价比较；
8、你需要识别出股票是横盘（成交量变化不大）、放量下跌、放量上涨、缓慢下跌、缓慢上涨，如果股票从亏损状态放量上涨，那么继续持有股票；如果股票从亏损状态缓慢上涨，那么在它回撤1%时卖出股票；

对上面的交易策略的优化补充与完善:
1. 原策略基础:
    - 止损: 亏损10%触发。
    - 止盈: 盈利回撤3%且短时间放量下跌。
    - 开盘大幅下跌>3%（尤其是前日上涨后），卖出。
    - 涨停持有。
    - 从亏损放量上涨继续持有；缓慢上涨回撤1%且处于盈利状态时卖出，如果未盈利继续持有。

2. 分钟级精细化:
    - 检测日内放量下跌: 最近10分钟volume > 日均1.5倍 + 价格跌>1%，结合天级信号卖出。
    - 波动率: 如果日内波动>5%且无向上突破，卖出锁定利润。
    - 趋势确认: 使用分钟数据计算短期均线，如果分钟MA5 < MA10 + 天级死叉，强化卖出。

3. 趋势与风险管理:
    - 整体趋势: 如果最近5天close > MA10，继续持有；否则结合其他信号。
    - 累计回撤: 从历史高回撤>5% + 技术指标恶化（MACD死叉或KDJ超买后回落），卖出。
    - 横盘识别: 最近5天价格波动<2% + volume低（<均值0.8倍） + KDJ在40-60，如果小盈利（>2%）卖出。
    - 从亏损恢复: 反弹后若MACD顶背离（价格新高但MACD未新高）或KDJ J>80，卖出。

4. 成交量确认:
    - 放量上涨: volume > 均值1.5倍 + 价格上涨，继续持有。
    - 缩量上涨: 警惕，若回撤>1%卖出。
    - 放量下跌: 立即卖出，尤其在支撑位。

5. 多天衔接与异常处理:
    - 开盘衔接: 比较当天open与前日close，处理跳空。
    - 综合评分: 多个信号触发时（>2个卖出信号），强制卖出。

如果还有未考虑的场景，你需要继续补充，让整个交易策略可以获取最大收益，减少亏损。
'''